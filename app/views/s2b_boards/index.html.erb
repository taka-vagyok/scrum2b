<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'version', :plugin => 'scrum2b' %>
  <%= javascript_include_tag "angular.min.js", :plugin => 'scrum2b' %>
<% end %>

<script>
  var project = angular.module('project', []);
    project.controller('BoardsCtrl', function ($scope){
      $scope.versions = [
          <% @list_versions_open.each do |version| %>
            {"name":" <%= version.name %> ","id":" <%= version.id %> "},
          <% end %>
          ];
      $scope.members = [
          <% @members.each do |member| %>
            {"name":" <%= member.firstname + ' ' + member.lastname %> ","id":" <%= member.id %> "},
          <% end %>
          ];
      $scope.new_issues = [
          <% @new_issues.each do |issue| %>
            {"subject":" <%= issue.subject %> ","id":" <%= issue.id %> ","assigned_to":"<%= issue.assigned_to %>","description":"<%= issue.description %>"},
          <% end %>
          ];
      
          
      });
</script>

<style type="text/css">
	#content {padding: 5px 0px !important; }
  body { margin: 0;}

  .padding_5 {padding: 5px; }
  .content { width: 100%; height: auto; margin: 0 auto; position: relative; }
  .s2b_column_3 {width: 20%; float: left; }
  .s2b_column_4 { width: 26.66666666667%; float: left;}
  .s2b_column_5 { width: 32.2% !important; float: left;}
  .background_d {background: #7996a5 !important; color: #ebebeb}
  .width_75 {width: 72.5%; float: right;}
  .width_33 {width: 33.33333% !important;}
  .border_status {border: 1px solid #9a9a9a;}

  .sprint_1, .sprint_2, .sprint_3, .sprint_4 {height: auto !important; padding-bottom: 50px !important;}
  .backlog {min-height: 50px; z-index: 30; position: absolute; left: 30px; width: 25%; }

  .backlog span {font-family: Tahoma,Verdana,Arial,sans-serif; color: #eb8f00; font-size: 18px;}
  .backlog .icon_add_issue img { float: right; }
  .backlog #sortable_backlog { overflow: auto; height: 450px !important; min-height: 450px !important; max-height: 450px !important; }
  /*filter*/
  .filter { height: 60px; background: #275888; color: #ebebeb;}
  .filter h3,.filter p {color: #ebebeb;margin:0px;padding:0px;}
  .filter h3 {margin-top:5px;line-height: 28px}
  .filter .filter_left { width: 30%; float: left;text-align: center }
  .filter .filter_right { width: 70%; float: left; }
  .filter .filter_left ul { display: inline-flex; list-style: none; margin:0;padding: 0px }
  .filter .filter_right ul { float: right; text-align: right; display: inline-flex; list-style: none; margin: 0 5px  0 0;padding: 0px }
  .filter .filter_right ul li { margin-left: 10px; line-height: 60px}
  .filter .filter_right ul li select,.filter .filter_right ul li input  {border-radius: 2px; height: 20px;padding: 0 5px;border: none}
  {border-radius: 2px; height: 20px;padding: 0 5px}

  .icon_backlog { background: #9cc3a8 url("/plugin_assets/scrum2b/images/next.png") no-repeat 67px 6px; line-height: 20px; padding: 5px 5px; margin: 0px 6px; 	 display: block; width: 80px; margin: 5px; color: #ebebeb; font-size: 14px; font-weight: bold;}
  .message { width: 30%; height: 100px; text-align: center; position: fixed; top: 10px; left: 440px; z-index: 1001;background: #C18888; opacity: 0.5;}
  .message span { position: fixed; top: 13px; z-index: 1010; left: 808px;  }
  .message span img {width: 20px; height: 20px; }
  .ui-accordion-content { padding-left: 0px !important; padding-right: 0px !important; }
  .closed_backlog img { height: 20px; width: 20px; position: absolute; top: 120px; }

  .sprint_total { }

  /*chi hien 3 sprint dau an colose*/
  .backlog_mode .backlog { display: block;}
  .backlog_mode .issue_closed { display: none;}
  .backlog_mode .open_sprint_closed { display: none; }
  /*.backlog_mode .icon_add_issue {display: block;}*/
  .backlog_mode .add_new_issue {display: none;}
  /*hien 3 trang thai chinh*/
  .basic_mode .backlog { display: none;}
  .basic_mode .issue_closed { display: none;}
  .basic_mode .open_sprint_closed { display: block; }
  /*hien du 4 cai*/
  .full_mode .issue_closed { display: block;}
  .full_mode .backlog { display: none;}
  .full_mode .open_sprint_closed { display: none; }
  .full_mode .closed_backlog {display: none;}

  .ui-state-active {background: linear-gradient(#ECA947, #D29539) !important; }

  .title_sprint {background: #275888; border-radius: 0px !important; color: #ebebeb }

  .status_sprint {height: 35px; background: linear-gradient(#ECA947, #D29539); }
  .status_sprint span { line-height: 35px; font-weight: bold; color: #ebebeb; margin-left: 10px; font-size: 16px;}
  .status_sprint .icon_add_issue {float: right; border: 1px; line-height: 20px; padding: 1px 4px; margin: 5px 6px;
   background: #9cc3a8 url("/plugin_assets/scrum2b/images/icon_add.png") no-repeat 5px 3px; font-size: 14px; width: 45px; text-align: right;
    }
  .title_issue { position: relative; }
  .title_issue a{ line-height: 0px !important; color: #54626d !important; }
  .title_issue .icon_config{ position: absolute; top: 0px; right: 0px; }
  .title_issue .icon_config img { width: 20px; height: 20px; float: right; cursor: pointer; }
  .title_issue a { font-size: 14px; line-height: 40px; }
  .issue {background: #f3f3d1 !important; border: 1px solid; padding: 3px; position: relative; margin-bottom: 5px; margin-top: 5px; }

  /*cac trang thai cua issue*/
  .mini_mode .title_issue .icon_config { display: none;}
  .mini_mode .content_issue {display: none;}
  .mini_mode .detail_issue {display: none;}
  .mini_mode .file_comment {display: none;}
  .mini_mode .file {display: none;}
  .mini_mode .comment {display: none;}

  .small_mode .title_issue .icon_config { display: block;}
  .small_mode .content_issue {display: block;}
  .small_mode .detail_issue {display: none;}
  .small_mode .file_comment {display: none;}
  .small_mode .file {display: none;}
  .small_mode .comment {display: none;}

  .normal_mode .title_issue .icon_config { display: block;}
  .normal_mode .content_issue {display: block;}
  .normal_mode .detail_issue {display: block;}
  .normal_mode .file_comment {display: block;}
  .normal_mode .file {display: none;}
  .normal_mode .comment {display: none;}

  .setting { position: absolute; top: 25px; right: 5px; background: #ddd; z-index: 100; }
  .setting ul { list-style: none; margin: 0px; padding: 5px; border: 1px solid; }
  .setting ul li { font-size: 14px; padding: 3px 0px; }
  .setting ul li:hover { background: #555; }

  .content_issue { position: relative; margin-top: 7px;}
  .content_issue .select_progess_issue { position: absolute; border: 1px solid; top: 21px; right: 0px; width: 51px; padding: 0px; z-index: 300;}
  .amount {width: 30px; border: 0px}
  .slider-vertical {float: right;}
  .triangle {width: 0px; height: 0px; float: left; border-top: 0 solid transparent; border-bottom: 102px solid transparent; border-right: 34px solid yellow; }

  .detail_issue {}
  .content_issue .avata img { height: 40px; width: 40px; }
  .icon_down, .icon_top {float: right !important; width: 44px; background: #ededed; padding: 3px 0px;}
  .icon_down img, .icon_top img {float: right; height: 15px; width: 15px; cursor: pointer; margin-right: 13px;}
  .progress_issue { width: 30%; float: right; text-align: right; margin-top: 0px; }
  .progress_issue span { font-size: 14px; color: #e77315; float: left; }
  .progress_issue .value_progess {width: 60px; float: right; height: 20px;}
  .progress_issue .value_progess input {color: #e77315; background: #f3f3d1; text-align: right; margin: 0;}
  .detail h4 { font-size: 15px; margin-top: 10px; margin-bottom: 10px; }
  .detail p { font-size: 13px; margin: 4px 0px; }

  .file_comment { height: 22px; }
  .file_comment ul { background: #7996a5; display: inline-flex; list-style: none; float: left; margin: 0px; padding: 0px; background: #7996a5 }
  .file_comment ul li { font-size: 13px; padding: 3px; margin-left: 1px; background: #ededed;}
  .file_comment ul li:first-child {margin-left: 0px !important;}
  .file_comment .open_file, .file_comment  .open_comment { cursor: pointer;} 
  .comment, .file { background: #7996a5; }
  .comment p { margin: 0px; padding: 5px 0px;}
  .comment ul {list-style: none; padding: 0px; }
  .comment ul li{ display: none; }
  .comment ul li:first-child { display: inline; }
  .comment .avata img { height: 30px; width: 30px; }
  .comment ul li span { font-size: 12px; }
  .comment .view_comment { color: #598DC1; font-size: 12px; cursor: pointer; }

  .file ul { list-style: none; padding: 0px; }
  .file p {  margin: 0px; padding: 5px 0px; }
  .file ul li{  display: none; }
  .file ul li:first-child { display: inline; }
  .file .icon_file img { height: 30px; width: 30px; }
  .file ul li span { font-size: 12px; }
  .file .view_file { color: #598DC1; font-size: 12px; cursor: pointer; }

  .closed_issue {width: 45px; text-align: right; float: right;line-height: 20px !important; padding: 1px 4px; margin: 5px 6px; background: #9cc3a8 url("/plugin_assets/scrum2b/images/icon_hide.png") no-repeat 3px 3px; font-size: 14px !important; }
  .closed_issue img { height: 15px; width: 15px; }

  .hide { display: none; }
  .open_sprint_closed { float: right;}
  .open_sprint_closed span img { height: 20px; width: 20px; }
  .test { z-index: 101 !important; top: 310px !important; left: 339px !important; }
  .connectedSortable { min-height: 75px; padding: 5px !important; }
  .issue_closed .content_issue, .issue_closed .detail_issue { display: none; }
  .issue_closed .issue { }

  .add_new_issue { border: 1px solid #cccccc; background: #f6f6f6; padding: 5px 5px; font-size: 12px; }
  .add_new_issue table span { font-size: 12px; line-height: 20px; }
  .add_new_issue table { width: 100%; }
  .add_new_issue table tr { margin: 2px 0px; }
  .add_new_issue table tr td { width: 50%; }
  .add_new_issue .title_issue { width: 100%; }
  .add_new_issue .issue_description { width: 99%;height: 80px; font-family: Trebuchet MS,Tahoma,Verdana,Arial,sans-serif; }
  .add_new_issue .end, .add_new_issue .begin, .add_new_issue .time { width: 70px; float: right; }
  .add_new_issue .value_content { float: right; width: 73px; }
  .add_new_issue .assign_up {position: relative;}
  .add_new_issue .assign {border: 1px solid; height: 33px; padding-left: 5px}
  .add_new_issue .assign img {height: 25px; width: 25px;}
  .add_new_issue .assign .sans_down { height: 20px;width: 10px; float: right; display: none; margin-top: 8px;}
  .add_new_issue .assign:hover .sans_down { display: block;}

  .add_new_issue .select_assign {border: 1px solid; background: #C6C6C6; position: absolute; z-index: 100; width: 151px; }
  .add_new_issue .select_assign img {height: 25px; width: 25px;}
  .add_new_issue .select_assign ul { list-style: none; padding-left: 0px; margin: 0px;}
  .add_new_issue .select_assign ul li {padding-left: 5px;}
  .add_new_issue .select_assign ul li:hover {background: #666 }

  .absolute_backlog { position: absolute;}
  .fixed_backlog { position: fixed; top: 0px;}

  .connectedSortable .issue {color: #54626d; padding: 3px 3px 0px 3px; !important; }
  .connectedSortable .issue:first-child {margin-top: 0px;}
  .connectedSortable .issue:last-child {margin-bottom: 0px;}

  .move_issue { border: 1px solid #1694C7; opacity: 0.5; }

  .ui-sortable-placeholder { visibility: visible !important; }

  .location_start_issue { height: 30px; background: #666; opacity: 0.5}

</style>


<div  ng-app="project" >
<div class="content full_mode" ng-controller="BoardsCtrl">
  <div  class="filter" >
    <div class="filter_left">
      <h3>Scrum2B Tool Demo prototype</h3>
      <p>(Desktop suppork only)</p>
    </div>

    <div class="filter_right">
      <ul >
        <li>
          <select>
            <option ng-repeat="version in versions" value="{{ version.id }}">{{ version.name }}</option>
          </select>
        </li>
        <li>
          <select name="select_member" id="select_member">
            <option value="all" ><%= l(:label_select_all_member)%></option>
            <% if User.current.logged? %>
             <option value="me" <% if session[:params_select_member] && session[:params_select_member] == "me" %><%= selected="selected" %><% end %>><%= l(:label_select_me)%></option>
            <% end %>
            <option ng-repeat="member in members" value=" {{ member.id }}">{{ member.name }}</option>
          </select>
        </li>
        <li>
        	<input type="button" value="Filter">
        </li>
      </ul>
    </div>
  </div> <!--end filter-->
  <span class="icon_backlog">Backlog </span>
  <span class="closed_backlog" ><img src="images/icon-left.png"></span>
  
  <!-- Backlog -->
  <%= render :partial => "/s2b_boards/backlog" %>

  <!--begin 4 sprint-->
  <div id="accordion" class="sprint_total">
    <h3 class="title_sprint" >Sprint 1</h3>
    <div class="sprint_1 sprint sprint-active">
      <div class="s2b_column_4 hide_backlog ">
        <div class="padding_5 ">
	        <div class="border_status">
	          <div class="status_sprint">
	            <span>New Isuse</span>
	            <span class="icon_add_issue">Add</span>
	          </div>
	          
	          <!-- add new issue -->
	          <%= render :partial => "/s2b_boards/add_new_issue" %>

	          <div class="connectedSortable check_height" id="sortable1" >
	          
	          	<!-- issue -->
	          	<%= render :partial => "/s2b_boards/issue" %>

	          </div><!--end connectedSortable-->
	        </div><!--end border-->

        </div><!--end padding 5 -->
      </div><!--end sprint 1-->
      <div class="s2b_column_4 hide_backlog">
        <div class="padding_5">
        	<div class="border_status">
	          <div class="status_sprint">
	            <span>In Progess</span>
	            <span class="icon_add_issue">Add</span>
	          </div>
	          
	          <!-- add new issue -->
	          <%= render :partial => "/s2b_boards/add_new_issue" %>

	          <div class="connectedSortable check_height" id="sortable2" >

	            <!-- issue -->
	          	<%= render :partial => "/s2b_boards/issue" %>
	          	<!-- issue -->
	          	<%= render :partial => "/s2b_boards/issue" %>
	          	<!-- issue -->
	          	<%= render :partial => "/s2b_boards/issue" %>

	          </div><!--end connectedSortable-->  
          </div><!--end border status-->
        </div><!--end padding 5 -->
      </div><!--end sprint 2-->
      <div class="s2b_column_4 hide_backlog">
      	<div class="padding_5">
	      	<div class="border_status">
	          <div class="status_sprint">
	            <span>Resolved</span>
	          </div>

	          <div class="connectedSortable check_height" id="sortable3">
	            <%= render :partial => "/s2b_boards/issue" %>

	            <%= render :partial => "/s2b_boards/issue" %>

	          </div><!--end connectedSortable-->  
	        </div><!--end padding 5 -->
        </div><!--end border status-->
      </div><!--end sprint 3-->
      <div class="s2b_column_3 issue_closed" id="issue_closed">
        <div class="padding_5">
        	<div class="border_status">
          <div class="status_sprint">
            <span>Close</span>
            <span class="closed_issue">Hide</span> 
          </div>

          <div class="connectedSortable check_height" id="sortable4">

            <%= render :partial => "/s2b_boards/issue" %>
            <%= render :partial => "/s2b_boards/issue" %>
 
          </div><!--end connectedSortable-->  
          </div>
        </div><!--end padding 5 -->
      </div><!--end sprint 4-->
      <div class="open_sprint_closed">
        <span ><img src="images/icon-left.png"></span>
      </div>
    </div>
    <h3 class="title_sprint" >Sprint 2</h3>
    <div class="sprint_2 sprint">
      sprint 2
    </div>
    
    <h3 class="title_sprint" >Sprint 3</h3>
    <div class="sprint_3 sprint">
     	sprint 3
    </div>  

    <h3 class="title_sprint" >Sprint 4</h3>
    <div class="sprint_4 sprint">
      sprint 4
    </div>
  </div>
  <!--end 4 sprint -->

  <!--popup--
  <div class="popup_content">
    <div class="popup">popup</div>
  </div><!--end popup-->

</div><!--end content-->
</div>
<script type="text/javascript">
	
$(document).ready(function(){

	$( "#accordion" ).accordion({ animate: 180, collapsible: true, heightStyle: "auto", cancel: "a,button" });

	check_height_max();

	$('.title_sprint').on('click',function(){
		$('.sprint').removeClass('sprint-active');
		$(this).next().addClass('sprint-active');
		check_height_max();
	})

	//progess issue
	$( ".slider-vertical" ).slider({
      orientation: "vertical",
      range: "min",
      min: 0,
      max: 100,
      step: 10,
      value: 0,
      slide: function( event, ui ) {
        $(this).parent().parent().find( ".amount" ).val( ui.value );
      }
    });
  $( ".amount" ).val( $( ".slider-vertical" ).slider( "value" ) );

	$(document).click(function(e){ 
		$('.select_progess_issue').hide();
		e.stopPropagation();
	});

	$('.select_progess_issue').on('click',function(){
		$(this).show();
	})

	$(".value_progess").click(function(e){
		$('.select_progess_issue').hide();
		$(this).parent().find('.select_progess_issue').toggle();
		e.stopPropagation();
	});

	// show hide name tool
	$('.cancel_message').on('click',function(){
		$(this).parent().hide();
	})

	// show hide setting
	$(document).click(function(e){ 
		$('.setting').hide();
		e.stopPropagation();
	});

	$('.setting').on('click',function(){
		$(this).show();
	})

	$(".icon_config").click(function(e){
		$('.setting').hide();
		$(this).parent().parent().find(".setting").toggle();
		e.stopPropagation();
	});

	$(".icon_down").click(function(){
		$(this).hide();
		$(this).parent().parent().parent().addClass('normal_mode');
		$(this).parent().parent().parent().removeClass('small_mode');
		$(this).parent().parent().parent().find('.icon_top').show();
		check_height_max();
	});

	$(".icon_top").click(function(){
		$(this).hide();
		$(this).parent().parent().parent().removeClass('normal_mode');
		$(this).parent().parent().parent().addClass('small_mode');
		$(this).parent().parent().parent().find('.icon_down').show();
		check_height_max();
	});

	$(".open_file").click(function(){
		$(this).parent().parent().parent().parent().find(".file").toggle();
		$(this).parent().parent().parent().parent().find(".comment").hide();
		$(this).parent().toggleClass("background_d");
		$(this).parent().parent().find('.open_comment').parent().removeClass("background_d");
		check_height_max();
	});

	$(".open_comment").click(function(){
		$(this).parent().parent().parent().parent().find(".file").hide();
		$(this).parent().parent().parent().parent().find(".comment").toggle();
		$(this).parent().toggleClass("background_d");
		$(this).parent().parent().find('.open_file').parent().removeClass("background_d");
		check_height_max();
	});

	$(".view_comment").click(function(){
		$(this).parent().parent().find(".comment ul li").show();
		check_height_max();
	});

	$(".view_file").click(function(){
		$(this).parent().parent().find(".file ul li").show();
		check_height_max();
	});

	$(".closed_issue").click(function(){
		$('.content').removeClass('full_mode');
		$('.content').addClass('basic_mode');
		$('.content').find('.s2b_column_4').addClass("s2b_column_5");
		check_height_max();
	});

	$(".open_sprint_closed").click(function(){
		$('.content').removeClass('basic_mode');
		$('.content').addClass('full_mode');
		$('.content').find('.s2b_column_4').removeClass("s2b_column_5");
	});

	$( "#sortable1, #sortable2, #sortable3, #sortable4, #sortable_backlog " ).sortable({
		connectWith: ".connectedSortable"
	}).disableSelection();

	$( "#sortable1, #sortable2, #sortable3, #sortable4 " ).on( "sortout", function( event, ui ) {	
		$('.content').find('.hide_backlog').find('.content_issue').show();
	});

	$( "#sortable1, #sortable2, #sortable3, #sortable4, #sortable_backlog " ).on( "sortover", function( event, ui ) {
		$(this).parent().addClass('background_d');
		$('.ui-sortable-helper').addClass('move_issue');
		a = $(this).attr('class');
		if ($('.location_start_issue').length == 0 ) {
			$("<div class='location_start_issue'></div>").insertAfter(".move_issue");
		};
		check_height_max();
	});

	$( "#sortable1, #sortable2, #sortable3, #sortable4 " ).on( "sortout", function( event, ui ) {
		$(this).parent().removeClass("background_d");
	});

	$( "#sortable1, #sortable2, #sortable3, #sortable4, #sortable_backlog  " ).on( "sortstop", function( event, ui ) {
		 $( ".location_start_issue" ).remove();
		check_height_max();
	});
	
	$( "#sortable1, #sortable2, #sortable3, #sortable4, #sortable_backlog " ).on( "sortbeforestop", function( event, ui ) {
		$('.move_issue').removeClass('move_issue');
	});
	
	function check_height_max(){
		$(".sprint-active .check_height").css("height","auto");
		var height1 =	$(".sprint-active #sortable1").height();
		var height2 =	$(".sprint-active #sortable2").height();
		var height3 =	$(".sprint-active #sortable3").height();
		var height4 =	$(".sprint-active #sortable4").height();
		var array_height = [height1, height2, height3, height4];
		var max_height = Math.max.apply(Math, array_height);
 		$(".sprint-active .check_height").css("height",max_height);
	}

	$(".icon_backlog").click(function(){
		$(this).hide();
		$('.s2b_column_4').removeClass('hide_backlog');
		$('.closed_backlog').show();
		$('.content').removeClass('full_mode');
		$('.content').removeClass('basic_mode');
		$('.content').addClass('backlog_mode');
		$('.sprint_total').addClass('width_75');
		$('.issue').removeClass('small_mode');
		$('.issue').removeClass('normal_mode');
		$('.issue').addClass('mini_mode');
		$('.sprint_total').find('.s2b_column_4').addClass('width_33');
		$('.add_new_issue').hide();
		check_height_max();
	});

	$(".closed_backlog").click(function(){
		$(this).hide();
		$('.s2b_column_4').addClass('hide_backlog');
		$('.icon_backlog').show();
		$('.content').removeClass('backlog_mode');
		$('.content').addClass('full_mode');
		$('.content').find('.sprint_total').removeClass('width_75');
		$('.content').find('.sprint_total').find('.s2b_column_4').removeClass('width_33');
		$('.content').find('.sprint_total').find('.s2b_column_4').removeClass('s2b_column_5');
		$('.issue').removeClass('mini_mode');
		$('.issue').addClass('small_mode');
		$('.add_new_issue').hide();
		check_height_max();
	});

	$(".icon_add_issue").click(function(){
		$(this).parent().parent().find('.add_new_issue').show();
	});
	
	$(".cancel_issue").click(function(){
		$(this).parent().parent().parent().parent().parent().parent().hide();
	});

	$(function() {
    $( ".add_new_issue .begin, .add_new_issue .end " ).datepicker();
  });

  $(document).click(function(e){ 
		$('.select_assign').hide();
		e.stopPropagation();
	});

	$('.select_assign').on('click',function(){
		$(this).show();
	})

	$(".assign").click(function(e){
		$('.select_assign').hide();
		$(this).parent().parent().find(".select_assign").toggle();
		e.stopPropagation();
	});

	$(window).scroll(function() {
    if($('.backlog').offset().top - $(window).scrollTop() > 0){
    	if( $('#accordion').offset().top - $(window).scrollTop() > 0){
    		$('.backlog').addClass('absolute_backlog');
    		$('.backlog').removeClass('fixed_backlog');
    	}else{
    		$('.backlog').addClass('fixed_backlog');
    		$('.backlog').removeClass('absolute_backlog');
    	}
	  } else {
	  	if( $('#accordion').offset().top - $(window).scrollTop() < 0){
    		$('.backlog').addClass('fixed_backlog');
    		$('.backlog').removeClass('absolute_backlog');
    	}else{
    		$('.backlog').addClass('absolute_backlog');
    		$('.backlog').removeClass('fixed_backlog');
    	}
	  } 
	});

});

</script>